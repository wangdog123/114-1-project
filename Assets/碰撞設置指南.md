# 碰撞系統設置指南

## 修改說明

已經從**距離檢測**改為 **Unity 碰撞系統**，更準確可靠！

---

## 為什麼改用碰撞系統？

### 原本的問題（距離檢測）
❌ 劃過去沒反應  
❌ 有時候亂劃才會打到  
❌ 看起來沒打到卻判定打到  
❌ 檢測不精確  

### 碰撞系統的優勢
✅ Unity 內建，精確可靠  
✅ 光標碰到就觸發，不會漏掉  
✅ 自動處理重疊檢測  
✅ 不需要每幀計算距離  

---

## Unity 設置步驟

### 1. 設置虛擬光標（Cursor UI）

**給光標添加碰撞器：**

1. 選擇你的 **Cursor UI** 物件（Image）
2. Add Component → **Circle Collider 2D**
3. 設置：
   ```
   Is Trigger: ✓ 勾選
   Radius: 20 (根據光標大小調整)
   ```
4. Add Component → **Rigidbody 2D**
5. 設置：
   ```
   Body Type: Kinematic
   Simulated: ✓ 勾選
   Use Auto Mass: ✗ 不勾選
   Gravity Scale: 0
   ```
6. 設置 **Tag**：
   - 在 Inspector 頂部 Tag 下拉選單
   - Add Tag → 輸入 "Cursor"
   - 回到 Cursor UI，設置 Tag 為 "Cursor"

---

### 2. 設置目標預製體（Slash Target Prefab）

**給目標添加碰撞器：**

1. 打開 **SlashTarget** 預製體
2. Add Component → **Box Collider 2D**（或 Circle Collider 2D）
3. 設置：
   ```
   Is Trigger: ✓ 勾選
   Size: 自動 (或手動調整覆蓋整個目標)
   ```
4. 確保目標有 **SlashTarget** 腳本
5. 保存預製體

---

### 3. 確保 Canvas 設置正確

Canvas 必須正確設置才能讓 2D 碰撞工作：

1. 選擇 **Canvas**
2. 確認設置：
   ```
   Render Mode: Screen Space - Overlay
   ```

---

## 工作原理

```
光標 (CircleCollider2D + Rigidbody2D + Tag:"Cursor")
  |
  | 移動劃過
  ↓
目標 (BoxCollider2D + SlashTarget 腳本)
  |
  | OnTriggerEnter2D 觸發
  ↓
呼叫 gameManager.OnTargetHit(this)
  |
  ↓
檢查是否正確順序 → 成功/失敗
```

---

## 程式碼改動

### ScratchRhythmGame.cs
- ✅ 移除 `scratchDetectionRadius`
- ✅ 移除 `CheckCursorCollision()` 方法
- ✅ `OnTargetHit()` 改為 `public`，由目標呼叫

### SlashTarget.cs
- ✅ 添加 `OnTriggerEnter2D()` 碰撞檢測
- ✅ 添加 `hasBeenHit` 防止重複觸發
- ✅ 自動尋找 `ScratchRhythmGame` 管理器

### VirtualCursor.cs
- 不需要修改（保持原樣）

---

## 測試清單

### ✓ 檢查項目

1. **光標設置**
   - [ ] Cursor UI 有 Circle Collider 2D
   - [ ] Is Trigger 勾選
   - [ ] 有 Rigidbody 2D (Kinematic)
   - [ ] Tag 設為 "Cursor"

2. **目標設置**
   - [ ] SlashTarget 預製體有 Box Collider 2D
   - [ ] Is Trigger 勾選
   - [ ] 有 SlashTarget 腳本

3. **Canvas 設置**
   - [ ] Render Mode = Screen Space - Overlay

4. **測試**
   - [ ] 運行遊戲
   - [ ] 移動光標劃過目標
   - [ ] 應該立即觸發（綠色閃爍）
   - [ ] 不再出現「劃過沒反應」的問題

---

## 故障排除

### 問題：劃過還是沒反應

**檢查 1：碰撞器設置**
```
Cursor UI:
- 有 Circle Collider 2D? 
- Is Trigger 勾選了嗎?
- Tag 是 "Cursor" 嗎?

SlashTarget:
- 有 Box Collider 2D?
- Is Trigger 勾選了嗎?
```

**檢查 2：圖層設置**
```
Edit → Project Settings → Physics 2D
確認 Layer Collision Matrix 中
UI 層可以和 UI 層碰撞
```

**檢查 3：Rigidbody 2D**
```
Cursor UI 必須有 Rigidbody 2D
Body Type = Kinematic
```

### 問題：碰撞觸發太多次

✅ 已經用 `hasBeenHit` 標記防止重複觸發

### 問題：Console 報錯

**錯誤：NullReferenceException**
- 檢查 gameManager 是否找到
- 確認場景中有 ScratchRhythmGame 腳本

---

## 調整碰撞範圍

### 讓光標更容易打到（放寬判定）
```
增大目標碰撞器：
Box Collider 2D → Size → (120, 120)
```

### 讓判定更精確（嚴格判定）
```
縮小目標碰撞器：
Box Collider 2D → Size → (80, 80)
```

---

## 優勢總結

| 項目 | 距離檢測 | 碰撞系統 |
|------|----------|----------|
| 準確度 | ❌ 不穩定 | ✅ 精確 |
| 性能 | ❌ 每幀計算 | ✅ 事件觸發 |
| 可靠性 | ❌ 會漏掉 | ✅ 不會漏 |
| 設置 | 簡單 | 需要設置碰撞器 |

**結論：碰撞系統更適合節奏遊戲！**
