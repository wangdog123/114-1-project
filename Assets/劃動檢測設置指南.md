# 劃動檢測節奏遊戲 - 設置指南

## 改進說明

### 1. **防止目標位置太近**
- 新增參數：`targetMinDistance = 150f` 
- 在生成目標位置時，會自動檢查與已有目標的距離
- 如果太近會重新隨機生成位置（最多嘗試 20 次）

### 2. **序列逐個顯示**
- 新增參數：`sequenceShowInterval = 0.5f`
- 序列會逐個出現，讓玩家更清楚看到順序
- 例如："記住這個順序：" → "← " → "← → " → "← → ↑ "

### 3. **劃動距離/時間檢測（不是單純碰到）**
- 新增參數：
  - `minSlashDistance = 50f` - 最小劃動距離（像素）
  - `minSlashTime = 0.1f` - 最小劃動時間（秒）
  - `maxSlashTime = 2f` - 最大劃動時間（超過算失敗）

- **工作原理**：
  1. 光標進入目標範圍時開始記錄
  2. 持續追蹤光標在範圍內的移動距離
  3. 當累積距離達到 `minSlashDistance` 時才算完成
  4. 如果時間太短或太長，會給出反饋但不算成功
  5. 離開範圍會重置劃動狀態

### 4. **視覺反饋改進**
- 開始劃動時：目標變淡黃色（表示正在檢測）
- 劃動太短離開：恢復白色
- 成功完成：綠色並淡出
- 失敗：紅色閃爍

## Inspector 設置

### ScratchRhythmGame 組件

#### 遊戲設置
- **Cursor**: VirtualCursor 引用
- **Sequence Length**: 3（序列長度）
- **Display Time**: 2（顯示時間）
- **Action Time**: 3（玩家操作時間）
- **Sequence Show Interval**: 0.5（序列逐個顯示間隔）

#### 劃痕檢測設置 ⭐ 新增
- **Min Slash Distance**: 50（最小劃動距離，像素）
- **Min Slash Time**: 0.1（最小劃動時間，秒）
- **Max Slash Time**: 2.0（最大劃動時間，秒）
- **Target Min Distance**: 150（目標之間最小距離）

#### 難度設置
- **Current Level**: 1
- **Speed Multiplier**: 1

#### UI 引用
- **Slash Targets Parent**: Canvas 中的容器
- **Slash Target Prefab**: SlashTarget 預製體
- **Sequence Display Text**: TextMeshProUGUI
- **Score Text**: TextMeshProUGUI
- **Feedback Text**: TextMeshProUGUI

### SlashTarget 預製體

#### 需要的組件
1. **Image** - 背景圖片
2. **TextMeshProUGUI** - 顯示方向和序號（子物件）
3. **SlashTarget 腳本**

#### SlashTarget 腳本設置
- **Detection Radius**: 50（檢測半徑）
- **Background Image**: 背景 Image 組件引用
- **Direction Text**: 文字 TextMeshProUGUI 引用

## 調整建議

### 讓劃動更容易
```
minSlashDistance = 30f  // 降低最小距離
minSlashTime = 0.05f    // 降低最小時間
maxSlashTime = 3f       // 增加最大時間
detectionRadius = 60f   // 增加檢測範圍
```

### 讓劃動更嚴格
```
minSlashDistance = 80f  // 提高最小距離
minSlashTime = 0.2f     // 提高最小時間
maxSlashTime = 1.5f     // 減少最大時間
detectionRadius = 40f   // 減小檢測範圍
```

### 防止目標重疊
```
targetMinDistance = 200f  // 增加最小距離
```

## 遊戲流程

1. **顯示序列**：逐個顯示方向符號
2. **記憶時間**：完整序列顯示一段時間
3. **執行階段**：
   - 目標同時出現在屏幕上
   - 玩家需要**按順序**劃過每個目標
   - 劃動時需要：
     - 在目標範圍內停留
     - 移動足夠的距離（不是只碰到）
     - 速度適中（不能太快或太慢）
4. **反饋**：
   - "劃太短！" - 距離不夠
   - "速度不對！" - 太快或太慢
   - "順序錯誤！" - 打錯順序
   - "Perfect! +100" - 成功

## 常見問題

### Q: 劃過去沒反應？
A: 確保：
1. 光標確實進入了目標範圍（檢查 `detectionRadius`）
2. 在範圍內移動了足夠距離（檢查 `minSlashDistance`）
3. 不要移動太快離開範圍

### Q: 目標太近重疊？
A: 增加 `targetMinDistance` 參數（例如從 150 改成 200）

### Q: 看不清順序？
A: 增加 `sequenceShowInterval`（例如從 0.5 改成 0.8）

### Q: 劃動判定太難？
A: 調整這些參數：
- 降低 `minSlashDistance`（例如 50 → 30）
- 增加 `detectionRadius`（例如 50 → 60）
- 增加 `maxSlashTime`（例如 2 → 3）

## 技術細節

### 劃動檢測算法
```csharp
// 每幀在 ScratchRhythmGame.CheckSlashProgress() 中呼叫
1. 計算光標與當前目標的距離
2. 如果在範圍內：
   - 首次進入：記錄起點和時間
   - 持續追蹤：累加移動距離
   - 達到閾值：完成劃動
3. 如果離開範圍：重置狀態
```

### 距離累積方式
```csharp
// 在 SlashTarget.OnCursorInside() 中
totalSlashDistance += Vector2.Distance(currentPos, lastPos);
```

這確保了玩家需要**真正劃過目標**，而不只是碰一下就算。
